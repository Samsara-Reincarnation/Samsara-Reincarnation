actor DSparilStaff : Weapon
{
	Weapon.ammouse 5
	Weapon.ammogive 30
	Weapon.ammotype "Cell"
	Weapon.SlotNumber 7
	Inventory.pickupmessage "staff of d'sparil"
	Obituary "%o was no match for %k"
	Inventory.RestrictedTo "CorvusPlayer"
    Tag "Staff of D'Sparil"
	States
	{
	Ready:
		DSPS A 1 A_WeaponReady
		loop
	Select:
		DSPS A 1 A_Raise
		loop
	Deselect:
		DSPS A 1 A_Lower
		loop
	Fire:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"CoopFire")
        TNT1 A 0 A_JumpIfInventory("PowerHereticTome",1,"FireTomed")
		TNT1 A 0 A_JumpIfInventory("PowerHereticTomePerma",1,"FireTomed")
		DSPS A 4
		DSPS A 4 A_PlayWeaponSound("dsparil/attack")
		NULL A 0 A_GunFlash
		DSPS B 4 bright
		DSPS C 4 bright A_FireCustomMissile("Sorcerer2FX4")
		DSPS B 4 bright
		DSPS B 4
		DSPS A 8
		DSPS A 4 A_ReFire
		goto ready
	FireTomed:
	    DSPS A 8
		DSPS A 4 A_PlayWeaponSound("DSparil/Attack")
		NULL A 0 A_GunFlash
		DSPS B 4 bright
		//NULL A 0 A_FireCustomMissile("Sorcerer2FX5",25)
		//NULL A 0 A_FireCustomMissile("Sorcerer2FX5",-25)
	FireTomedLoop:
		TNT1 A 0 A_PlayWeaponSound("dsparil/zap")
		NULL A 0 A_FireCustomMissile("DSparilStaff_LightningHelix",0,0,2,4)
		NULL A 0 A_FireCustomMissile("DSparilStaff_LightningHelix2",0,0,-2,4)
		TNT1 A 0 A_TakeInventory("Cell",1,TIF_NOTAKEINFINITE)
		DSPS B 2 bright 
		TNT1 A 0 A_Refire("FireTomedLoop")
	FireTomedFinish:
		DSPS B 0 A_PlayWeaponSound("DSparil/Attack")
		DSPS B 4 bright
		DSPS B 4
		DSPS A 8
		DSPS A 4 bright A_ReFire
		goto ready

    CoopFire:
        TNT1 A 0 A_JumpIfInventory("PowerHereticTome",1,"CoopFireTomed")
		TNT1 A 0 A_JumpIfInventory("PowerHereticTomePerma",1,"CoopFireTomed")
		DSPS A 4
		DSPS A 4 A_PlayWeaponSound("dsparil/attack")
		NULL A 0 A_GunFlash
		DSPS B 4 bright
		DSPS C 4 bright A_FireCustomMissile("Sorcerer2FX4_Coop")
		DSPS B 4 bright
		DSPS B 4
		DSPS A 8
		DSPS A 4 A_ReFire
		goto ready

    CoopFireTomed: // Don't really see the point of this but it's here if needed
        DSPS A 10
		DSPS A 4 A_PlayWeaponSound("DSparil/Attack")
		NULL A 0 A_GunFlash
		DSPS D 4 bright
	CoopFireTomedLoop:
		TNT1 A 0 A_PlayWeaponSound("dsparil/zap")
		NULL A 0 A_FireCustomMissile("DSparilStaff_LightningHelix_Coop",0,0,2,4)
		NULL A 0 A_FireCustomMissile("DSparilStaff_LightningHelix2_Coop",0,0,-2,4)
		TNT1 A 0 A_TakeInventory("Cell",1)
		DSPS B 2 bright 
		TNT1 A 0 A_Refire("CoopFireTomedLoop")
	CoopFireTomedFinish:
		DSPS B 0 A_PlayWeaponSound("DSparil/Attack")
		DSPS B 4 bright
		DSPS B 4
		DSPS A 8
		DSPS A 4 bright A_ReFire
		goto ready
	Flash:
		NULL A 4 A_Light1
		NULL A 4 A_Light2
		NULL A 4 A_Light1
		Goto LightDone
	Spawn:
		DSTF A -1
		stop
	}
}

actor Sorcerer2FX4 : Sorcerer2FX1
{
	Speed 30
    DamageType "Electric"
	Damage 50
	States
	{
		Death:
			FX16 G 5 Bright A_Explode(200, 128, XF_HURTSOURCE)
			FX16 HIJKL 5 Bright
			Stop
	}
}

actor Sorcerer2FX4_Coop : Sorcerer2FX4 
{ 
	+THRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
	Species "Player" 
} 

actor DSparilStaff_LightningHelix : FastProjectile
{
	Radius 2
	Height 4
	Speed 24
	DamageType "Electric"
	Damage 3
	+EXTREMEDEATH
	States
	{
		Spawn:
			TNT1 A 1 A_Weave(3, 3, 1.25, 1.25)
			TNT1 A 0 A_SpawnItemEx("DSparilStaff_LightningHelixParticle",0,0,0,frandom(-0.5,-0.5),frandom(-0.5,0.5),frandom(-0.5,0.5))
			loop
		Death:
			TNT1 A 0 A_Jump(192,2)
			TNT1 A 0 A_Playsound("heretic/staffcrackle")
			TNT1 A 0 A_SetScale(0.175)
			FX16 G 3 Bright A_Explode(10, 10, 0)
			FX16 HIJKL 3 Bright
			Stop
	}
}

actor DSparilStaff_LightningHelix2 : DSparilStaff_LightningHelix  { WeaveIndexXY 32 WeaveIndexZ 32 }

actor DSparilStaff_LightningHelixParticle
{
	Radius 2
	Height 4
	Scale 0.175
	+NOGRAVITY
	+NOINTERACTION
	States
	{
		Spawn:
			FAXE RSTUVWX 2 Bright
			Stop
	}
}

actor DSparilStaff_LightningHelix_Coop : DSparilStaff_LightningHelix 
{
	+THRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
	Species "Player" 
}

actor DSparilStaff_LightningHelix2_Coop : DSparilStaff_LightningHelix2 
{
	+THRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
	Species "Player" 
}

// Leftovers from when the staff summoned enemies instead of lightning
actor Sorcerer2FX5
{
	Radius 10
	Height 6
	Speed 6
	Damage 10
	PROJECTILE
	renderstyle add
	states
	{
	Spawn:
		FX11 ABABABAB 5 bright
		goto Summon
	Summon:
		NULL A 0 A_SpawnItemEx("TeleportFog",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)
		NULL A 0 A_SpawnItemEx("FWizard",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)
		stop
	Death:
		FX11 CDEFG 5 BRIGHT
		Stop
	}
}
actor FWizard : Wizard
{ 
	+FRIENDLY 
	+NOTDMATCH
    +NOICEDEATH
    DamageFactor "CorvusCrossbow", 1.15
    DamageFactor "DragonClaw", 1.5
    PainChance "MightyBoot", 255
    DropItem "BlasterAmmo2", 84
    DropItem "ArtiHealth", 4, 0
    BloodColor Purple
	var int user_scalex;
	var int user_scaley;
    States
    {
      Raise:
        TNT1 A 0 A_JumpIfInventory("EnemyZorched",1,"ZorchRaise")
        WZRD MLKJIHGF 4 
        Goto See

      ZorchRaise:
        TNT1 A 1 A_UnsetShootable
        TNT1 A 1 A_SpawnItem("SpawnFire2")
        TNT1 A 0 A_PlaySound("archvile/resummon")
        TNT1 A 1 A_TakeInventory("EnemyZorched",1)
        TNT1 A 0 A_NoGravity
        TNT1 A 0 A_SetTranslucent(0.1,0)
        WZRD A 3 A_SetTranslucent(0.2,0)
        WZRD A 3 A_SetTranslucent(0.3,0)
        WZRD A 3 A_SetTranslucent(0.4,0)
        WZRD A 3 A_SetTranslucent(0.5,0)
        WZRD A 3 A_SetTranslucent(0.6,0)
        WZRD A 3 A_SetTranslucent(0.7,0)
        WZRD A 3 A_SetTranslucent(0.8,0)
        WZRD A 3 A_SetTranslucent(0.9,0)
        WZRD A 3 A_SetTranslucent(1,0)
        WZRD A 1 A_SetShootable
        Goto See

      Death:
        TNT1 A 0 A_SpawnItemEx("UniversalBloodyHellGoreDeathEffect",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_USEBLOODCOLOR)
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraClientDecorate",0,11)
        goto "Super::Death"

      Death.DukeExplosive:
      Death.DukeDamage:
      Death.DukePistol:
        TNT1 A 0 A_Jump(218,"Death")
        TNT1 A 0 A_GiveToTarget("DukeKillTaunt",1)
        goto Death

      Death.MightyBoot:
        TNT1 A 0 A_PlaySoundEx("duke/kickhit","body",0,0)
        TNT1 A 0 A_Jump(64,"Death")
        TNT1 A 0 A_GiveToTarget("DukeBootTaunt",1)
        goto Death

      Death.DukeIce:
        "####" "#" 0 A_PlaySound("duke/enemyfreeze")
        "####" "#" 0 A_GiveInventory("FreezethrowerWeakness")
        "####" "#" 0 A_Jump(218,"Ice")
        "####" "#" 0 A_GiveToTarget("DukeKillTaunt",1)
        goto Ice
        
      Pain.MightyBoot:
        TNT1 A 0 A_ChangeFlag("NOPAIN",1)
        TNT1 A 0 A_PlaySoundEx("duke/kickhit","body",0,0)
        WZRD E 2 A_FaceTarget
        TNT1 A 0 A_Recoil(14)
        WZRD E 16 A_Pain
        Goto See

      Missile:
        TNT1 A 0 A_ChangeFlag("NOPAIN",0)
        goto "Super::Missile"
        
      Pain.LifeLeech:
			TNT1 A 0 A_GiveToTarget("SerpentHealth", random(1,2))
			TNT1 A 0 A_GiveToTarget("HealthBonus",1)
			Goto Pain		
		Pain.Vodoo:
			TNT1 A 0 A_GiveToTarget("Voodoo", 1)
			Goto Pain
		Death.Vodoo:
		Death.VoodooPuff:
		Death.DynamiteCoop:
		Death.Dynamite:
		Death.LifeLeech:
		Death.CalebNapalm:
		Death.Shock:	  
		Death.Vodoo:
		Death.Tesla:
		Death.CalebFire:	
		Death.CalebBullet:	
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("CalebDMTaunt1", 1)
			Goto Death
		Death.EradExplosive:
		Death.EradNova:
		Death.EradShock:
		Death.EradExplosive2:	
		Death.EradDisc:
		Death.EradPiercingDart:
		Death.EradGreenFire:
		Death.EradCoopGreenFire:
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("EleenaDMTaunt1", 1)
			Goto Death
		Death.PSRAPower:
		Death.PSRAPowerCoop:
		Death.PSExplosive:
		Death.PSExplosiveCoop:
		Death.PSBullet:
		Death.PSFire:	
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("JonDMTaunt1", 1)
			Goto Death
		Death.LeonardDamage2:
		Death.LeonardDamage3:
		Death.LeonardDamage0:
		Death.LeonardDamage1:	
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("LeonardDMTaunt1", 1)
			Goto Death
		Death.SWSticky:
		Death.SWStickyCoop:	
		Death.SWGrenade:
		Death.SWNuke:
		Death.SWRocket:
		Death.SWRailgun:
		Death.SWRailgunCoop:
		Death.SWNukeCoop:
		Death.SWFlame:
		Death.SWFlame2:
		Death.SWFlame2Coop:
		Death.SWFlame3:	
		Death.SWBullet:	  
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("LoWangDMTaunt1", 1)
			goto Death
		Death.QuakeElectric:
		Death.NotQuadded:
		Death.QuakeExplosive:
			TNT1 A 0 A_JumpIfHealthLower(-50, "XDeathForRanger")
			goto Death
		XDeath.QuakeElectric:
		XDeath.NotQuadded:
		XDeath.QuakeExplosive:
		XDeathForRanger:
			TNT1 A 0 A_GiveToTarget("KillCount",1)  
			TNT1 A 0 A_SpawnItemEx("QuakeGibSpawner",0,0,0,0,0,0,0,SXF_USEBLOODCOLOR|SXF_NOCHECKPOSITION)
			TNT1 A 0 A_Fall
			TNT1 A 5 A_FadeOut
			Stop
		Death.BittermanDamage:
			TNT1 A 0 A_JumpIfHealthLower(-50, "XdeathForBitterman")
			goto Death
		XdeathForBitterman:
			TNT1 A 0 A_GiveToTarget("KillCount",1)  
			TNT1 A 0 A_SpawnItemEx("Q2ColorGibSpawner",0,0,0,0,0,0,0,SXF_USEBLOODCOLOR|SXF_NOCHECKPOSITION)
			TNT1 A 0 A_Fall
			TNT1 A 5 A_FadeOut
			Stop
		Ice:
		Death.HexenIce:
		Death.WTMeleeIce:
		Death.WTRangedIce:
		Death.Ice:
			"####" "#" 0 A_GiveToTarget("KillCount",1)
			"####" "#" 0 A_NoBlocking
			"####" "#" 0 A_GenericFreezeDeath
			"####" "#" 70 A_UnsetSolid
			"####" "#" 0 A_IceGuyDie
			"####" "#" 1 A_IceGuyDie
			TNT1 A 0
			stop
		Death.ZorchPistol:
		Death.Zorch:
		Death.ZorchKamikaze:
		Death.PhasingZorch:
		Death.ZorchSpectral:
			"####" "#" 0 A_GiveToTarget("KillCount",1)
			"####" "#" 0 A_NoGravity
			"####" "#" 0 A_Stop
			"####" "#" 0 A_ChangeFlag("DONTGIB",1)
			"####" "#" 0 A_PlaySoundEx("chex/zorch","soundslot5",0,0)
			"####" "#" 3 A_SpawnItem("ZorchEffectSmall")
			"####" "#" 0 A_GiveInventory("EnemyZorched",1)
			"####" "#" 3 A_SetTranslucent(0.9,0)
			"####" "#" 0 A_Scream
			"####" "#" 3 A_SetTranslucent(0.8,0)
			"####" "#" 0 A_NoBlocking
			"####" "#" 3 A_SetTranslucent(0.7,0)
			"####" "#" 3 A_SetTranslucent(0.6,0)
			"####" "#" 3 A_SetTranslucent(0.5,0)
			"####" "#" 3 A_SetTranslucent(0.4,0)
			"####" "#" 3 A_SetTranslucent(0.3,0)
			"####" "#" 3 A_SetTranslucent(0.2,0)
			"####" "#" 3 A_SetTranslucent(0.1,0) 
			TNT1 A 1 A_SetTranslucent(1,0)
			TNT1 A 0 A_Gravity
			TNT1 A -1
			stop
		Death.RottDisintegrate:
			"####" "#" 0 A_ChangeFlag("SOLID", 0)
			"####" "#" 0 A_GiveToTarget("KillCount",1)
			"####" "#" 0 A_Scream
			"####" "#" 0 A_NoBlocking	
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 0 A_Stop
			"####" "#" 0 A_ChangeFlag("SHOOTABLE",FALSE)
			"####" "#" 0 A_ChangeFlag("NOGRAVITY",TRUE)
			"####" "#" 0 A_ChangeFlag("FLOORCLIP",TRUE)
			"####" "#" 0 A_SpawnItem("RGodModeDeathSmall")
			"####" "#" 3 A_SetTranslucent(0.9,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.8,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.7,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.6,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.5,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.4,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.3,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.2,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.1,0)
			stop
		Disintegrate:
			"####" "#" 0 A_GiveToTarget("KillCount",1)
			"####" "#" 0 A_NoBlocking
			"####" "#" 0 A_ChangeFlag("DONTGIB",1)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 0 A_Scream
			"####" "#" 0 A_ChangeFlag("SOLID",FALSE)
			"####" "#" 0 A_ChangeFlag("SHOOTABLE",FALSE)
			"####" "#" 0 A_ChangeFlag("NOGRAVITY",TRUE)
			"####" "#" 0 A_ChangeFlag("FLOORCLIP",TRUE)
			"####" "#" 0 A_Stop
			"####" "#" 3 A_SpawnItem("DisintEffectSmall",0,10)
			"####" "#" 3 A_SetTranslucent(0.9,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.8,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.7,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.6,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.5,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.4,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.3,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.2,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.1,0)
			stop
		Death.Nuke:
			"####" "#" 0 A_ChangeFlag("SOLID", 0)
			"####" "#" 0 A_GiveToTarget("KillCount",1)
			"####" "#" 0 A_Scream
			"####" "#" 0 A_NoBlocking		
			"####" "#" 0 A_SpawnItem("WTNukeDeathSmall")
			"####" "#################" 3 A_Fadeout(0.05)
			stop
	}
}