Actor StrifePoisonAmmo : Ammo
{
	Inventory.MaxAmount 50
	Ammo.BackPackAmount 2
	Ammo.BackPackMaxAmount 100
	Inventory.Icon "AMSMP0"
}	

ACTOR "  Crossbow  " : StrifeCrossbow
{
  Weapon.Kickback 100
  +INVENTORY.UNDROPPABLE
  +Weapon.NOALERT
  Inventory.PickUpSound "strife/weaponget"
  Weapon.SelectionOrder 1200
  Weapon.AmmoUse1 0
  Weapon.AmmoUse2 0
  Weapon.AmmoGive1 8
  Weapon.AmmoGive2 0
  Weapon.AmmoType1 "Shell"
  Weapon.AmmoType2 "StrifePoisonAmmo"
  Weapon.SlotNumber 2
  Inventory.PickupMessage "You picked up the Crossbow."
  Weapon.SisterWeapon ""
  Obituary "%k \cishocked\c- %o \ciwith an electric bolt."
  Inventory.RestrictedTo "StrifeguyPlayer"
  Tag "Crossbow"
  States
  {
  Spawn:
    SXBW A -1
    Stop
  Ready:
    SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"ReadyPoison")
	SBOW A 0 A_ShowElectricFlash
    SBOW A 1 A_WeaponReady
    Wait
  Deselect:
    SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"DeselectPoison")
    SBOW A 1 A_Lower
    Loop
  Select:
    SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"SelectPoison")
    SBOW A 1 A_Raise
    Loop
  Fire:
	SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"FirePoison")
	SBOW A 0 A_JumpIfInventory("Shell", 1, "FireElec")
	Goto Ready
  FireElec:
    SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"FirePoison")
    SBOW A 3 A_ClearFlash
	SBOW A 0 A_TakeInventory("Shell", 1, TIF_NOTAKEINFINITE)
	SBOW A 0 A_PlayWeaponSound("strife/xbowfire")
	SBOW A 0 A_JumpIfInventory("CoopModeOn",1,"CoopFire")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",10,"Fire.Accuracy100")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",8,"Fire.Accuracy80")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",6,"Fire.Accuracy60")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",4,"Fire.Accuracy40")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",2,"Fire.Accuracy20")
    SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-280,280)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
    Goto Ready+2
  AltFire:
	SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"AltFirePoison")
    SBOW A 0 A_ClearFlash
    SBOW AAAAAAAAAAAA 1 A_Lower
    SBOW A 0 A_GiveInventory("CrossbowMode",1)
	SBOW HHHHHHHHHHHH 1 A_Raise
	Goto Ready
  AltFirePoison:
    SBOW HHHHHHHHHHHH 1 A_Lower
	SBOW H 0 A_TakeInventory("CrossbowMode",1)
	SBOW AAAAAAAAAAAA 1 A_Raise
	Goto Ready
  CoopFire:
    SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"CoopFirePoison")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",10,"CoopFire.Accuracy100")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",8,"CoopFire.Accuracy80")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",6,"CoopFire.Accuracy60")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",4,"CoopFire.Accuracy40")
	SBOW A 0 A_JumpIfInventory("AccuracyUpgrade2",2,"CoopFire.Accuracy20")
    SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-280,280)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
    Goto Ready+2
  Fire.Accuracy20:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-140,140)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  Fire.Accuracy40:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-70,70)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  Fire.Accuracy60:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-35,35)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  Fire.Accuracy80:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-17,17)/1000.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  Fire.Accuracy100:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",0,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  CoopFire.Accuracy20:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-140,140)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  CoopFire.Accuracy40:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-70,70)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  CoopFire.Accuracy60:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-35,35)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  CoopFire.Accuracy80:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-17,17)/1000.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  CoopFire.Accuracy100:
	SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",0,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW F 4
    SBOW G 0 A_ShowElectricFlash
    SBOW G 5 A_CheckReload
	Goto Ready+2
  Flash:
    SBOW KLM 5 bright
    Loop
  ReadyPoison:
    SBOW H 1 A_WeaponReady
    Loop
  DeselectPoison:
    SBOW H 1 A_Lower
    Loop
  SelectPoison:
    SBOW H 1 A_Raise
    Loop
  FirePoison:
    SBOW H 0 A_JumpIfInventory("StrifePoisonAmmo",1,2)
	SBOW A 0 A_Jump(255, "AltFirePoison")
    SBOW H 3
	SBOW H 0 A_TakeInventory("StrifePoisonAmmo", 1, TIF_NOTAKEINFINITE)
	SBOW H 0 A_PlayWeaponSound("strife/xbowfire")
	SBOW H 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFirePoison")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",10,"FirePoison.Accuracy100")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",8,"FirePoison.Accuracy80")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",6,"FirePoison.Accuracy60")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",4,"FirePoison.Accuracy40")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",2,"FirePoison.Accuracy20")
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-280,280)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
    Goto Ready
  CoopFirePoison:
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",10,"CoopFirePoison.Accuracy100")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",8,"CoopFirePoison.Accuracy80")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",6,"CoopFirePoison.Accuracy60")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",4,"CoopFirePoison.Accuracy40")
	SBOW H 0 A_JumpIfInventory("AccuracyUpgrade2",2,"CoopFirePoison.Accuracy20")
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-280,280)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
    Goto Ready
  FirePoison.Accuracy20:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-140,140)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  FirePoison.Accuracy40:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-70,70)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  FirePoison.Accuracy60:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-35,35)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  FirePoison.Accuracy80:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-17,17)/1000.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  FirePoison.Accuracy100:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",0,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  CoopFirePoison.Accuracy20:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-140,140)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  CoopFirePoison.Accuracy40:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-70,70)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  CoopFirePoison.Accuracy60:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-35,35)/100.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  CoopFirePoison.Accuracy80:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-17,17)/1000.00,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  CoopFirePoison.Accuracy100:
    SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",0,1,0,0,0)
    SBOW C 4
    SBOW D 6
    SBOW E 3
    SBOW I 4
    SBOW J 5 A_CheckReload
	Goto Ready
  }
}

ACTOR StrifeElectricBolt
{
  Speed 30
  Radius 10
  Height 10
  Damage (random(1,4)*20) // was 10
  Damagetype "ElectricBolt"
  Projectile
  +NOBLOCKMAP
  +NOGRAVITY
  +DROPOFF
  MaxStepHeight 4
  Decal "CrossbowScorch2"
  SeeSound "strife/punchswing"
  //ActiveSound "strife/punchswing"
  DeathSound "strife/xbowhit"
  Obituary "%k \cishocked\c- %o \ciwith an electric bolt."
  
  States
  {
  Spawn:
    SRW1 A 10 A_LoopActiveSound
    Loop
  Death:
    AHIT A 3 bright A_AlertMonsters
    AHIT BCDEFE 3 bright
    AHIT DCB 2 bright
    AHIT A 1 bright
    Stop	
  }
}

actor StrifeElectricBolt2 : StrifeElectricBolt { +THRUSPECIES Species "Player" }

actor StrifePoisonBolt : CStaffMissile 
{
  Speed 40
  Radius 10
  Height 10
  +THRUGHOST
  +NOEXTREMEDEATH
  +BLOODSPLATTER
  +FORCERADIUSDMG
//  +ADDITIVEPOISONDAMAGE
//  +ADDITIVEPOISONDURATION
  Damage (random(1,4)*50)//was 500
  Damagetype "PoisonBolt"
//  PoisonDamage 2,1
  Projectile
  MaxStepHeight 4
  SeeSound "strife/punchswing"
  //ActiveSound "strife/punchswing"
  DeathSound ""
  Renderstyle Normal
  Obituary "%k \cipierced\c- %o \ciwith a poison bolt."
  
  States
  {
  Spawn:
    SRW2 A 10 A_LoopActiveSound
    Loop
  XDeath:
    TNT1 A 0
	SRW2 A 1 A_Explode(100, 10,0,false,10)
	Stop
  Crash:
  Death:
    SRW2 A 1
    Stop
  }
}

actor StrifePoisonBolt2 : StrifePoisonBolt { +THRUSPECIES Species "Player" }
actor CrossbowMode : Inventory { -INVBAR +INVENTORY.UNDROPPABLE inventory.maxamount 1 }