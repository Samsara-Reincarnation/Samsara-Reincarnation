Actor "PSMagnum" : Weapon
{
	Inventory.PickupSound "PS/Ipickup2"
	+WEAPON.WIMPY_WEAPON
	+INVENTORY.UNDROPPABLE
	Weapon.SelectionOrder 3700
	Weapon.BobStyle Smooth
	Weapon.BobRangeX 0.75
	Weapon.BobRangeY 0.28
	Weapon.BobSpeed 1.4	
	Weapon.SlotNumber 1
	Weapon.SlotPriority 1
	Weapon.AmmoType ""
	Weapon.AmmoUse 0
	Weapon.AmmoGive 0
	Obituary "%o killed %k with an ancient magnum."
	Inventory.RestrictedTo "PSPlayer"	
	Tag ".357 Magnum"  	
	States
	{
		Spawn:
			WMAG A -1
			Stop
		Select:
			MGNM A  1 A_Raise
			Loop
		Deselect:
			MGNM A	1 A_Lower
			Loop
		Ready:
			MGNM A 1 A_WeaponReady
			Loop
		Fire:
			TNT1 A 0 A_JumpIfInventory("PSMagnumDummy",6,"Reload")
			TNT1 A 0 A_GiveInventory("PSMagnumDummy",1)
			TNT1 A 0 A_PlaySound("PS/Magnum",CHAN_WEAPON)
			TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)			
			MGNM B 1 BRIGHT A_FireBullets(2,2,1,25,"PSBulletPuff", FBF_NORANDOM)
			Goto A
			MGNM B 1 BRIGHT A_FireBullets(2,2,1,25,"PSBulletPuffCoop", FBF_NORANDOM)
 		A:	
			MGNM C 1 BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM C 1 BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
//			MGNM D 1 BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM D 1 offset(2,41) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)				
			MGNM D 1 offset(3,47) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)	
			MGNM D 1 offset(5,55) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)	
			MGNM D 1 offset(4,56) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)							
			MGNM D 1 offset(3,57) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)				
			MGNM C 1 offset(-4,54) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM C 1 offset(-3,53) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM C 1 offset(-2,52) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)			
			MGNM A 1 offset(-1,51) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 offset(0,50) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 offset(0,47) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)		
			MGNM A 1 offset(0,43) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)		
			MGNM A 1 offset(0,37) BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)						
			MGNM A 1 BRIGHT A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 A_Refire
			Goto Ready
		Reload:
			TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"ClipReload")
		KeepReloading:			
			MGNM A 1 Offset(-6,39) A_PlaySound("PS/MagnumR",CHAN_BODY)
			MGNM A 1 Offset(-10,74) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)			
			MGNM A 1 Offset(-12,87) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-16,93) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)			
			MGNM A 1 Offset(-22,102) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)			
			MGNM A 1 Offset(-34,120) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM AAAA 1 Offset(-36,143) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			TNT1 A 0 A_PlaySound("PS/MagnumR",CHAN_WEAPON)
			MGNM A 1 Offset(-32,137) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-30,124) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-26,118) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-20,102) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-18,96) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-14,89) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-8,72) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			MGNM A 1 Offset(-6,38) A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_NOSWITCH)
			TNT1 A 0 A_TakeInventory("PSMagnumDummy",6)
			TNT1 A 0 A_TakeInventory("PistolAmmoCounterDummyShit",6)			
			TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"ReloadAmmo")			
			Goto Ready
		ClipReload:
			TNT1 A 0 A_JumpIfInventory("Clip",1,"KeepReloading")
			MGNM A 5 A_PlaySound("PS/MagnumE",CHAN_WEAPON)
			Goto Ready
		ReloadAmmo:
			TNT1 A 0 A_JumpIfInventory("Clip",1,1)
			Goto Ready
		ReloadAmmo2:
			TNT1 A 0 A_TakeInventory("Clip",1)
			TNT1 A 0 A_GiveInventory("PistolAmmoCounterDummyShit",1)
			TNT1 A 0 A_JumpIfInventory("PistolAmmoCounterDummyShit",6,"Ready")
			TNT1 A 0 A_JumpIfInventory("Clip",1,"ReloadAmmo2")
			Goto Ready			
	}
}

Actor PSMagnumDummy : Inventory {Inventory.Amount 1 Inventory.MaxAmount 6 }

Actor PSBullet1 : FastProjectile
{
  Speed 300
  Damage (25)
  Radius 1
  Height 1
  Species "Player"  
  Projectile
  +BLOODSPLATTER
  +NOTIMEFREEZE
  +NOEXTREMEDEATH
  +THRUSPECIES
  +DONTHARMCLASS
  +DONTHARMSPECIES
  +MTHRUSPECIES
  States
  {
  Spawn:
    TNT1 A 1
    Loop
  Death:
  Crash:  
	TNT1 A 0 A_PlaySound("PS/Ricoch")
    TNT1 A 1 A_SpawnItemEx("PSBulletPuff",0,0,0,0)        
    stop
  XDeath:
    TNT1 A 1
    stop
    }
}

Actor PistolAmmoCounterDummyShit : Inventory { Inventory.Amount 1 Inventory.MaxAmount 6 }