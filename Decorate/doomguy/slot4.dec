actor Doom64ChaingunRefireCount : Boolean {}

actor " Chaingun " : Weapon// : Chaingun doom64 chaingun fires slightly faster and has recoil bleh
{
    Weapon.SelectionOrder 700
    Weapon.AmmoUse 1
    Weapon.AmmoGive 0
    Weapon.AmmoType "Clip"
    Decal BulletChip
    Weapon.SlotNumber 4
	Tag "Chaingun"
    Inventory.PickupMessage "You got the Chaingun!"
    +THRUGHOST
    +INVENTORY.UNDROPPABLE
    Obituary "$SAMSARA_DOOMGUY_OB_SLOT4"
	Inventory.RestrictedTo "DoomguyPlayer"
    States
    {
      Ready:
		TNT1 A 0 A_JumpIfInventory("Doom64Mode", 1, "Ready64")
        DCHG N 1 A_WeaponReady
        Loop
		
      Ready64:
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 1 A_WeaponReady
        Goto Ready		

      Deselect:
		TNT1 A 0 A_JumpIfInventory("Doom64Mode", 1, "Deselect64")
        DCHG N 1 A_Lower
        Loop
		
      Deselect64:
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 1 A_Lower
        Loop		

      Select:
		TNT1 A 0 A_JumpIfInventory("Doom64Mode", 1, "Select64")
        DCHG N 1 A_Raise
        Loop
		
      Select64:
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 1 A_Raise
        Loop		

      Fire:
		TNT1 A 0 A_JumpIfInventory("Doom64Mode", 1, "Fire64")
        TNT1 A 0 A_JumpIfInventory("VanillaDoom", 1, "VanillaFire")//A_JumpIf(ACS_ExecuteWithResult(219, 0, 0, 0)==1, "VanillaFire")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG A 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2", FBF_USEAMMO|FBF_NORANDOM)
        DCHG B 2 BRIGHT
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG C 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2", FBF_USEAMMO|FBF_NORANDOM)
        DCHG D 2 BRIGHT
        DCHG N 1 A_ReFire
        Goto Ready
		
      Fire64:
		TNT1 A 0 A_JumpIfInventory("VanillaDoom", 1, "VanillaFire64")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire64")
        64CG A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 2 A_PlayWeaponSound("doom64guy/chngun")
		64CG B 2
        64CG B 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 2 A_PlaySound("doom64guy/chngun")
		64CG D 1
        64CG B 0 A_ReFire
        Goto Ready	
		
	  VanillaFire64:
        TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire64Vanilla")
        64CG A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 4 A_PlayWeaponSound("doom64guy/chngun")
        64CG B 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 3 A_PlaySound("doom64guy/chngun")
        64CG B 0 A_ReFire
        Goto Ready

	  CoopFire64Vanilla:
        64CG A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 4 A_PlayWeaponSound("doom64guy/chngun")
        64CG B 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 3 A_PlaySound("doom64guy/chngun")
        64CG B 0 A_ReFire
        Goto Ready

      Hold:
		TNT1 A 0 A_JumpIfInventory("Doom64Mode", 1, "Hold64")
        TNT1 A 0 A_JumpIfInventory("VanillaDoom", 1, "VanillaHold")//A_JumpIf(ACS_ExecuteWithResult(219, 0, 0, 0)==1, "VanillaHold")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopHold")		
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG A 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2", FBF_USEAMMO|FBF_NORANDOM)
        DCHG B 2 BRIGHT
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG C 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2", FBF_USEAMMO|FBF_NORANDOM)
        DCHG D 2 BRIGHT
        TNT1 A 0 A_ReFire
        DCHG N 1 A_ClearRefire
        Goto Ready
		
      Hold64:
		TNT1 A 0 A_JumpIfInventory("VanillaDoom", 1, "VanillaHold64")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopHold64")
        TNT1 A 0 A_JumpIfInventory("Doom64ChaingunRefireCount", 1, "Hold2")
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 2 A_PlaySound ("doom64guy/chngun", 6)
		64CG B 2 
        64CG B 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 2 A_PlaySound ("doom64guy/chngun", 7)
		64CG D 1
        64CG A 0 A_GiveInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready		
		
      Hold2:
        TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopHold2")
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 2 A_PlayWeaponSound("doom64guy/chngun")
		64CG B 2
        64CG B 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 2 A_PlaySound("doom64guy/chngun")
		64CG D 1
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready
		
      CoopHold64:
        TNT1 A 0 A_JumpIfInventory("Doom64ChaingunRefireCount", 1, "CoopHold2")
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 2 A_PlaySound ("doom64guy/chngun", 6)
		64CG B 2
        64CG B 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 2 A_PlaySound ("doom64guy/chngun", 7)
		64CG D 1
        64CG A 0 A_GiveInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready
		
      CoopHold2:
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 2 A_PlayWeaponSound("doom64guy/chngun")
		64CG B 2
        64CG B 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 2 A_PlaySound("doom64guy/chngun")
		64CG D 1
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready		
		
	  VanillaHold64:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopHold64Vanilla")
        TNT1 A 0 A_JumpIfInventory("Doom64ChaingunRefireCount", 1, "Hold2Vanilla")
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 4 A_PlaySound ("doom64guy/chngun", 6)
        64CG B 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 3 A_PlaySound ("doom64guy/chngun", 7)
        64CG A 0 A_GiveInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready		
		
      Hold2Vanilla:
        TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopHold2Vanilla")
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 4 A_PlayWeaponSound("doom64guy/chngun")
        64CG B 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 3 A_PlaySound("doom64guy/chngun")
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready	  
		
      CoopHold64Vanilla:
        TNT1 A 0 A_JumpIfInventory("Doom64ChaingunRefireCount", 1, "CoopHold2Vanilla")
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 4 A_PlaySound ("doom64guy/chngun", 6)
        64CG B 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 3 A_PlaySound ("doom64guy/chngun", 7)
        64CG A 0 A_GiveInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready
		
      CoopHold2Vanilla:
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 4 A_PlayWeaponSound("doom64guy/chngun")
        64CG B 0 A_FireBullets(5.6, 0, 1, 4*Random(1,4), "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 3 A_PlaySound("doom64guy/chngun")
        64CG A 0 A_TakeInventory("Doom64ChaingunRefireCount", 1)
        64CG A 0 A_ReFire
        Goto Ready		
        
      VanillaFire:
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG E 4 BRIGHT A_FireBullets (5.6, 0, 1, 5, "DoomBulletPuff2")
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG F 4 BRIGHT A_FireBullets (5.6, 0, 1, 5, "DoomBulletPuff2")
        DCHG N 1 A_ReFire
        Goto Ready

      VanillaHold:
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG E 4 BRIGHT A_FireBullets (5.6, 0, -1, 5, "DoomBulletPuff2")
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG F 4 BRIGHT A_FireBullets (5.6, 0, -1, 5, "DoomBulletPuff2")
        DCHG N 0 A_ReFire
        DCHG N 1 A_ClearRefire
        Goto Ready
        
      CoopFire:
        TNT1 A 0 A_JumpIfInventory("VanillaDoom", 1, "VanillaCoopFire")//A_JumpIf(ACS_ExecuteWithResult(219, 0, 0, 0)==1, "VanillaCoopFire")
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG A 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2_Coop", FBF_USEAMMO|FBF_NORANDOM)
        DCHG B 2 BRIGHT
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG C 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2_Coop", FBF_USEAMMO|FBF_NORANDOM)
        DCHG D 2 BRIGHT
        DCHG N 1 A_ReFire
        Goto Ready
		
      CoopFire64:
        TNT1 A 0 A_GunFlash("Flash64")
        64CG A 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG A 2 A_PlayWeaponSound("doom64guy/chngun")
		64CG B 2
        64CG B 0 A_FireBullets(5.6, 0, 1, Random(6,9)*2, "Doom64BulletPuff_Coop", FBF_NORANDOM|FBF_USEAMMO)
        64CG A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 2, 3, 11)
        64CG C 2 A_PlaySound("doom64guy/chngun")
		64CG D 1
        64CG B 0 A_ReFire
        Goto Ready		

      CoopHold:
        TNT1 A 0 A_JumpIfInventory("VanillaDoom", 1, "VanillaCoopHold")//A_JumpIf(ACS_ExecuteWithResult(219, 0, 0, 0)==1, "VanillaCoopHold")
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG A 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2_Coop", FBF_USEAMMO|FBF_NORANDOM)
        DCHG B 2 BRIGHT
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG C 2 BRIGHT A_FireBullets (5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2_Coop", FBF_USEAMMO|FBF_NORANDOM)
        DCHG D 2 BRIGHT
        TNT1 A 0 A_ReFire
        DCHG N 1 A_ClearRefire
        Goto Ready
        
      VanillaCoopFire:
        TNT1 A 0
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG E 4 BRIGHT A_FireBullets (5.6, 0, 1, 5, "DoomBulletPuff2_Coop")
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG F 4 BRIGHT A_FireBullets (5.6, 0, 1, 5, "DoomBulletPuff2_Coop")
        DCHG N 1 A_ReFire
        Goto Ready

      VanillaCoopHold:
        TNT1 A 0
        TNT1 A 0 A_GunFlash
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG E 4 BRIGHT A_FireBullets (5.6, 0, 1, 5, "DoomBulletPuff2_Coop")
        TNT1 A 0 A_PlayWeaponSound("doomguy/pistol")
        DCHG F 4 BRIGHT A_FireBullets (5.6, 0, 1, 5, "DoomBulletPuff2_Coop")
        DCHG N 0 A_ReFire
        DCHG N 1 A_ClearRefire
        Goto Ready
        
      Flash:
        TNT1 A 5 BRIGHT A_Light1
        TNT1 A 4 A_Light0
        Goto LightDone
		
      Flash64:
        64CM A 3 Bright
        TNT1 A 1
        64CM B 2 Bright
        TNT1 A 2
        Goto LightDone		

      Spawn:
        WCGN A -1
        Stop
    }
}

//=================================================================================================
//
// Minigun
//
//=================================================================================================

actor DGHasChaingun : Boolean {}
actor DGHasMinigun : Boolean {}
ACTOR " Minigun " : Weapon
{
	Radius 20
	Height 16
	Weapon.AmmoType "Clip" 
	Weapon.AmmoGive 0
	Weapon.AmmoUse 1
	Weapon.Selectionorder 700
	Weapon.Kickback 100
	Weapon.SlotNumber 4 // This line isn't in skulltag.pk3, which instead defines the slot directly in DoomPlayer
	Inventory.PickupMessage "$PICKUP_MINIGUN" // "You got the minigun!"
	Inventory.RestrictedTo "DoomguyPlayer"
	Obituary "$OB_MINIGUN" // "%o was drilled by %k's minigun."
	AttackSound "weapons/minigun"
	Tag "Minigun"
	States
	{
		Spawn:
			MNGN A -1
			Loop
		Ready:
			MNGG A 1 A_WeaponReady
			Loop
		Deselect:
			MNGG A 1 A_Lower
			Loop
		Select: 
			MNGG A 1 A_Raise 
			Loop  
		Fire: 
			TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
			MNGG A 0 A_GunFlash
			MNGG A 2 A_FireBullets(5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2", FBF_USEAMMO|FBF_NORANDOM)
			MNGG B 2 A_FireBullets(5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2", FBF_USEAMMO|FBF_NORANDOM)
			MNGG A 2 A_ReFire
			MNGG B 2
			MNGG A 4
			MNGG B 4
			MNGG A 8
			MNGG B 8
			Goto Ready 
		CoopFire:
			MNGG A 0 A_GunFlash
			MNGG A 2 A_FireBullets(5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2_Coop", FBF_USEAMMO|FBF_NORANDOM)
			MNGG B 2 A_FireBullets(5.6, 0, 1, Random(8,10)*2, "DoomBulletPuff2_Coop", FBF_USEAMMO|FBF_NORANDOM)
			MNGG A 2 A_ReFire
			MNGG B 2
			MNGG A 4
			MNGG B 4
			MNGG A 8
			MNGG B 8
			Goto Ready 		
		Flash: 
			MNGF A 3 BRIGHT A_Light1 
			MNGF B 3 BRIGHT A_Light0
			Stop 
	}
}
