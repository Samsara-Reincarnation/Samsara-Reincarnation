ACTOR thermal_str : Inventory { -INVBAR +INVENTORY.UNDROPPABLE Inventory.MaxAmount 18 }

actor "Thermal Detonator" : Weapon
{
  Weapon.AmmoType       "RocketAmmo"
  Weapon.AmmoType2      "RocketAmmo"
  Weapon.AmmoGive       5
  Weapon.BobStyle		Inverse
  Weapon.BobSpeed		1.05
  Weapon.BobRangeX	  	1.0
  Weapon.BobRangeY	  	0.55  
  Weapon.AmmoUse        1
  Weapon.AmmoUse2       1
  Weapon.SlotNumber     1
  Weapon.SelectionOrder 2200
  Weapon.SlotPriority   0
  +NOALERT
  +THRUGHOST
  +WEAPON.NOAUTOAIM
  +WEAPON.NOAUTOFIRE
  +WEAPON.EXPLOSIVE
  +INVENTORY.UNDROPPABLE
  Obituary "%k detonated\c- %o with a Thermal Detonator."
  Inventory.RestrictedTo "KatarnPlayer"
  Tag "Thermal Detonator"
  States
  {
    Spawn:
      IDET A -1
      Stop

    Ready:
	  TNT1 A 0 A_JumpIfNoAmmo("ReadyAmmoLess")
      KDET A 1 A_WeaponReady
      Loop
	  
    ReadyAmmoLess:
	  TNT1 A 0 A_JumpIfInventory("RocketAmmo",1,"Ready")
	  KDET B 1 A_WeaponReady
	  Loop
	
    Deselect:
	  TNT1 A 0 A_JumpIfNoAmmo("DeselectAmmoLess")	
      KDET A 0 A_Lower
      KDET A 1 A_Lower
      Goto Deselect+1
	  
	DeselectAmmoLess:
      KDET A 0 A_Lower
      KDET B 1 A_Lower
	  Loop
	  
    Select:
	  TNT1 A 0 A_JumpIfNoAmmo("SelectAmmoLess")	
      KDET A 0 A_Raise
      KDET A 1 A_Raise
      Goto Select+1

	SelectAmmoLess:
      KDET A 0 A_Raise
      KDET B 1 A_Raise
	  Loop

    Fire:
      KDET A 0 A_Lower
      KDET A 1 Offset(0,75)
      KDET A 0 A_WeaponReady(14)

    Hold:
      TNT1 AAAAAAAA 1 A_WeaponReady(14)
      TNT1 A 0 A_GiveInventory("thermal_str",1)
      TNT1 A 0 A_Refire

    Release:
      TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"CoopFire")
      TNT1 A 0 A_ClearRefire
      TNT1 A 1 A_WeaponReady(14)

    ReleaseConsider:
      TNT1 A 1
      TNT1 A 0 A_JumpIfInventory("thermal_str",18,"ReleaseSpeed10")
      TNT1 A 0 A_JumpIfInventory("thermal_str",16,"ReleaseSpeed9")
      TNT1 A 0 A_JumpIfInventory("thermal_str",14,"ReleaseSpeed8")
      TNT1 A 0 A_JumpIfInventory("thermal_str",12,"ReleaseSpeed7")
      TNT1 A 0 A_JumpIfInventory("thermal_str",10,"ReleaseSpeed6")
      TNT1 A 0 A_JumpIfInventory("thermal_str",8,"ReleaseSpeed5")
      TNT1 A 0 A_JumpIfInventory("thermal_str",6,"ReleaseSpeed4")
      TNT1 A 0 A_JumpIfInventory("thermal_str",4,"ReleaseSpeed3")
      TNT1 A 0 A_JumpIfInventory("thermal_str",2,"ReleaseSpeed2")
      TNT1 A 1 A_WeaponReady(14)

    ReleaseSpeed1:
      TNT1 A 0 A_FireCustomMissile("det_str1",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed2:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str2",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed3:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str3",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed4:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str4",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed5:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str5",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed6:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str6",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed7:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str7",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed8:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str8",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed9:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str9",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseSpeed10:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str10",0,1,2,0,0,15)
      goto ReleaseFinish

    ReleaseFinish:
      KDET B 2 A_WeaponReady(14)
      KDET BCDDDDDDDD 1 A_WeaponReady(14)
      TNT1 A 1 A_TakeInventory("thermal_str")
      TNT1 AAAAAAAAAA 0 A_Lower
      goto Ready
    
    CoopFire:
      TNT1 A 1 A_WeaponReady(14)

    CoopReleaseConsider:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_JumpIfInventory("thermal_str",18,"CoopReleaseSpeed10")
      TNT1 A 0 A_JumpIfInventory("thermal_str",16,"CoopReleaseSpeed9")
      TNT1 A 0 A_JumpIfInventory("thermal_str",14,"CoopReleaseSpeed8")
      TNT1 A 0 A_JumpIfInventory("thermal_str",12,"CoopReleaseSpeed7")
      TNT1 A 0 A_JumpIfInventory("thermal_str",10,"CoopReleaseSpeed6")
      TNT1 A 0 A_JumpIfInventory("thermal_str",8,"CoopReleaseSpeed5")
      TNT1 A 0 A_JumpIfInventory("thermal_str",6,"CoopReleaseSpeed4")
      TNT1 A 0 A_JumpIfInventory("thermal_str",4,"CoopReleaseSpeed3")
      TNT1 A 0 A_JumpIfInventory("thermal_str",2,"CoopReleaseSpeed2")
      TNT1 A 1 A_WeaponReady(14)

    CoopReleaseSpeed1:
      TNT1 A 0 A_FireCustomMissile("det_str1_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed2:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str2_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed3:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str3_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed4:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str4_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed5:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str5_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed6:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str6_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed7:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str7_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed8:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str8_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed9:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str9_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish

    CoopReleaseSpeed10:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det_str10_coop",0,1,2,0,0,15)
      goto CoopReleaseFinish
    
    CoopReleaseFinish:
      KDET B 2 A_WeaponReady(14)
      KDET BCDDDDDDDD 1 A_WeaponReady(14)
      TNT1 A 1 A_TakeInventory("thermal_str",999)
      TNT1 AAAAAAAAAA 0 A_Lower
      goto Ready
    
    AltFire:
      KDET A 0 A_Lower
      KDET A 1 A_Lower
      KDET A 0 A_WeaponReady(14)

    AltHold:
      TNT1 AAAAAAAA 1 A_WeaponReady(14)
      TNT1 A 0 A_GiveInventory("thermal_str",1)
      TNT1 A 0 A_Refire

    AltRelease:
      TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"AltCoopFire")
      TNT1 A 0 A_ClearRefire
      TNT1 A 1 A_WeaponReady(14)

    AltReleaseConsider:
      TNT1 A 1
      TNT1 A 0 A_JumpIfInventory("thermal_str",18,"AltReleaseSpeed10")
      TNT1 A 0 A_JumpIfInventory("thermal_str",16,"AltReleaseSpeed9")
      TNT1 A 0 A_JumpIfInventory("thermal_str",14,"AltReleaseSpeed8")
      TNT1 A 0 A_JumpIfInventory("thermal_str",12,"AltReleaseSpeed7")
      TNT1 A 0 A_JumpIfInventory("thermal_str",10,"AltReleaseSpeed6")
      TNT1 A 0 A_JumpIfInventory("thermal_str",8,"AltReleaseSpeed5")
      TNT1 A 0 A_JumpIfInventory("thermal_str",6,"AltReleaseSpeed4")
      TNT1 A 0 A_JumpIfInventory("thermal_str",4,"AltReleaseSpeed3")
      TNT1 A 0 A_JumpIfInventory("thermal_str",2,"AltReleaseSpeed2")
      TNT1 A 1 A_WeaponReady(14)

    AltReleaseSpeed1:
      TNT1 A 0 A_FireCustomMissile("det2_str1",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed2:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str2",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed3:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str3",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed4:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str4",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed5:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str5",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed6:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str6",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed7:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str7",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed8:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str8",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed9:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str9",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseSpeed10:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str10",0,1,2,0,0,15)
      goto AltReleaseFinish

    AltReleaseFinish:
      KDET B 2 A_WeaponReady(14)
      KDET BCDDDDDDDD 1 A_WeaponReady(14)
      TNT1 A 1 A_TakeInventory("thermal_str")
      TNT1 AAAAAAAAAA 0 A_Lower
      goto Ready
    
    AltCoopFire:
      TNT1 A 1 A_WeaponReady(14)

    AltCoopReleaseConsider:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_JumpIfInventory("thermal_str",18,"AltCoopReleaseSpeed10")
      TNT1 A 0 A_JumpIfInventory("thermal_str",16,"AltCoopReleaseSpeed9")
      TNT1 A 0 A_JumpIfInventory("thermal_str",14,"AltCoopReleaseSpeed8")
      TNT1 A 0 A_JumpIfInventory("thermal_str",12,"AltCoopReleaseSpeed7")
      TNT1 A 0 A_JumpIfInventory("thermal_str",10,"AltCoopReleaseSpeed6")
      TNT1 A 0 A_JumpIfInventory("thermal_str",8,"AltCoopReleaseSpeed5")
      TNT1 A 0 A_JumpIfInventory("thermal_str",6,"AltCoopReleaseSpeed4")
      TNT1 A 0 A_JumpIfInventory("thermal_str",4,"AltCoopReleaseSpeed3")
      TNT1 A 0 A_JumpIfInventory("thermal_str",2,"AltCoopReleaseSpeed2")
      TNT1 A 1 A_WeaponReady(14)

    AltCoopReleaseSpeed1:
      TNT1 A 0 A_FireCustomMissile("det2_str1_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed2:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str2_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed3:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str3_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed4:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str4_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed5:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str5_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed6:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str6_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed7:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str7_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed8:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str8_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed9:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str9_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish

    AltCoopReleaseSpeed10:
      TNT1 A 1 A_WeaponReady(14)
      TNT1 A 0 A_FireCustomMissile("det2_str10_coop",0,1,2,0,0,15)
      goto AltCoopReleaseFinish
    
    AltCoopReleaseFinish:
      KDET B 2 A_WeaponReady(14)
      KDET BCDDDDDDDD 1 A_WeaponReady(14)
      TNT1 A 1 A_TakeInventory("thermal_str",999)
      TNT1 AAAAAAAAAA 0 A_Lower
      goto Ready
  }
}

ACTOR detonator_katarn
{
  Health  5
  Radius  3
  Height  3
  Speed   7
  Damage  (0)
  Mass    50
  Scale   0.5
  Gravity 0.4
  PROJECTILE
  Obituary "%k detonated\c- %o with a Thermal Detonator."
  -NOGRAVITY
  +FORCERADIUSDMG
  +SHOOTABLE
  +NOBLOOD
  States
  {
    Spawn:
      PDET A 1
      Loop
    Death:
      TNT1 A 0
      TNT1 A 0 A_SpawnItemEx("explosion_small",0,0,0,0,0,0,SXF_CLIENTSIDE)
      TNT1 A 0 BRIGHT A_Explode(140,128,1,1)
      TNT1 A 0 A_PlaySound("katarn/exsmal",6,1.0,0,ATTN_NORM)
      TNT1 A 5 BRIGHT A_RadiusThrust(64,128)
      Stop
  }
}

ACTOR detonator2_katarn : detonator_katarn
{
  BounceFactor .35
  Damage  (0)  
  -NOBLOCKMAP
  -NOLIFTDROP
  -NOGRAVITY
  +NOTELEPORT
  -TELESTOMP
  +MOVEWITHSECTOR
  +BOUNCEONACTORS
  -DOOMBOUNCE
  +HEXENBOUNCE
  -EXPLODEONWATER
  +CANBOUNCEWATER
  States
  {
    Spawn:
      PDET A 105
      Goto Death
  }
}

ACTOR explosion_small
{
  Radius  6
  Height  6
  Scale   0.8
  +NOGRAVITY
  +CLIENTSIDEONLY
  States
  {
    Spawn:
      EXTH A 2
      EXTH B 2
      EXTH CDEF 2 BRIGHT
      EXTH GHIJKL 2
      Stop
  }
}

ACTOR det_str1 : detonator_katarn { Speed 4 }
ACTOR det_str2 : detonator_katarn { Speed 8 }
ACTOR det_str3 : detonator_katarn { Speed 12 }
ACTOR det_str4 : detonator_katarn { Speed 16 }
ACTOR det_str5 : detonator_katarn { Speed 20 }
ACTOR det_str6 : detonator_katarn { Speed 24 }
ACTOR det_str7 : detonator_katarn { Speed 28 }
ACTOR det_str8 : detonator_katarn { Speed 32 }
ACTOR det_str9 : detonator_katarn { Speed 36 }
ACTOR det_str10 : detonator_katarn { Speed 40 }

ACTOR det_str1_coop : detonator_katarn { Speed 4 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str2_coop : detonator_katarn { Speed 8 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str3_coop : detonator_katarn { Speed 12 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str4_coop : detonator_katarn { Speed 16 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str5_coop : detonator_katarn { Speed 20 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str6_coop : detonator_katarn { Speed 24 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str7_coop : detonator_katarn { Speed 28 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str8_coop : detonator_katarn { Speed 32 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str9_coop : detonator_katarn { Speed 36 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det_str10_coop : detonator_katarn { Speed 40 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }

ACTOR det2_str1 : detonator2_katarn { Speed 4 }
ACTOR det2_str2 : detonator2_katarn { Speed 8 }
ACTOR det2_str3 : detonator2_katarn { Speed 12 }
ACTOR det2_str4 : detonator2_katarn { Speed 16 }
ACTOR det2_str5 : detonator2_katarn { Speed 20 }
ACTOR det2_str6 : detonator2_katarn { Speed 24 }
ACTOR det2_str7 : detonator2_katarn { Speed 28 }
ACTOR det2_str8 : detonator2_katarn { Speed 32 }
ACTOR det2_str9 : detonator2_katarn { Speed 36 }
ACTOR det2_str10 : detonator2_katarn { Speed 40 }

ACTOR det2_str1_coop : detonator2_katarn { Speed 4 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str2_coop : detonator2_katarn { Speed 8 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str3_coop : detonator2_katarn { Speed 12 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str4_coop : detonator2_katarn { Speed 16 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str5_coop : detonator2_katarn { Speed 20 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str6_coop : detonator2_katarn { Speed 24 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str7_coop : detonator2_katarn { Speed 28 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str8_coop : detonator2_katarn { Speed 32 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str9_coop : detonator2_katarn { Speed 36 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }
ACTOR det2_str10_coop : detonator2_katarn { Speed 40 +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES Species "Player" }