actor "Concussion Rifle" : Weapon
{
  Weapon.SelectionOrder 500
  Weapon.BobStyle		Inverse
  Weapon.BobSpeed		1.05
  Weapon.BobRangeX	  	1.0
  Weapon.BobRangeY	  	0.55   
  Weapon.AmmoUse        4
  Weapon.AmmoUse2       4
  Weapon.AmmoGive       48
  Weapon.AmmoType       "Cell"
  Weapon.AmmoType2      "Cell"
  Weapon.SlotNumber     6
  Weapon.UpSound        "katarn/wepslct"
  Obituary              "%k ripped apart %o with the concussion rifle."
  +WEAPON.EXPLOSIVE
  +WEAPON.NOAUTOFIRE
  +INVENTORY.UNDROPPABLE
  Inventory.RestrictedTo "KatarnPlayer"    
  States
  {
    Ready:
      KCON A 2 A_WeaponReady
      Loop

    Deselect:
      TNT1 A 0 A_Lower
      KCON A 1 A_Lower
      Loop

    Select:
      TNT1 A 0 A_Raise
      KCON A 1 A_Raise
      Loop

    AltFire:
    Fire:
      TNT1 A 0 A_JumpIfInventory("KatarnFireRateUp",1,"FastFire")
      TNT1 A 0 A_JumpIfInventory("DMModeOn", 1, "DMFire")	  
      TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
      KCON B 1 BRIGHT 
      KCON B 0 A_PlayWeaponSound("katarn/conshot")	  
      KCON B 9 BRIGHT A_FireCustomMissile("concussion_projectile2",frandom(-4.00,4.00),1,0,0,0,frandom(-4,4))
      KCON B 0 A_GunFlash
      KCON C 2
      KCON A 14
      KCON AAAA 1 A_ReFire
      KCON AAAA 1 A_ReFire
      Goto Ready

    CoopFire:
      KCON B 1 BRIGHT
      KCON B 0 A_PlayWeaponSound("katarn/conshot")	  
      KCON B 9 BRIGHT A_FireCustomMissile("concussion_projectile2",frandom(-4,4),1,0,0,0,frandom(-4,4))
      KCON B 0 A_GunFlash
      KCON C 2
      KCON A 14
      KCON AAAA 1 A_ReFire
      KCON AAAA 1 A_ReFire
      Goto Ready
	  
	DMFire:
      KCON B 1 BRIGHT 
      KCON B 0 A_PlayWeaponSound("katarn/conshot")	  
      KCON B 9 BRIGHT A_FireCustomMissile("concussion_projectile",frandom(-4.00,4.00),1,0,0,0,frandom(-4,4))
      KCON B 0 A_GunFlash
      KCON C 2
      KCON A 14
      KCON AAAA 1 A_ReFire
      KCON AAAA 1 A_ReFire
      Goto Ready	

    FastFire:
	  TNT1 A 0 A_JumpIfInventory("DMModeOn", 1, "DMFastFire")	  
      TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFastFire")
      KCON B 1 BRIGHT
      KCON B 0 A_PlayWeaponSound("katarn/conshot")	  
      KCON B 4 BRIGHT A_FireCustomMissile("concussion_projectile2",frandom(-4.00,4.00),1,0,0,0,frandom(-4,4))
      KCON B 0 A_GunFlash
      KCON C 1
      KCON A 7
      KCON AAAA 1 A_ReFire
      KCON AAAA 1 A_ReFire
      Goto Ready

    CoopFastFire:
      KCON B 1 BRIGHT
      KCON B 0 A_PlayWeaponSound("katarn/conshot")	  
      KCON B 4 BRIGHT A_FireCustomMissile("concussion_projectile2",frandom(-4,4),1,0,0,0,frandom(-4,4))
      KCON B 0 A_GunFlash
      KCON C 1
      KCON A 7
      KCON AAAA 1 A_ReFire
      Goto Ready
	  
	DMFastFire:
      KCON B 1 BRIGHT
      KCON B 0 A_PlayWeaponSound("katarn/conshot")	  
      KCON B 4 BRIGHT A_FireCustomMissile("concussion_projectile",frandom(-4.00,4.00),1,0,0,0,frandom(-4,4))
      KCON B 0 A_GunFlash
      KCON C 1
      KCON A 7
      KCON AAAA 1 A_ReFire
      KCON AAAA 1 A_ReFire
      Goto Ready	

    Flash:
      TNT1 A 1 A_Light(2)
      TNT1 A 1 A_Light(1)
      TNT1 A 1 A_Light(0.0)
      Stop

    Spawn:
      ICON A -1
      Stop
  }
}

//weapon was changed to mimic Jedi Knights behavior instead of DarkForces.
//This was to avoid calling bfgspray to try and mimic the original behavior.
ACTOR concussion_projectile : FastProjectile
{
  +DONTBLAST
  Radius 3
  Height 3
  Speed 500
  Damage (0)
  Projectile
  -ROCKETTRAIL
  +DONTSPLASH
  +NOTELEPORT
  +OLDRADIUSDMG
  +FORCERADIUSDMG
  DONTHURTSHOOTER
  SeeSound ""
  DeathSound ""
  Obituary              "%k ripped apart %o with the concussion rifle."
  Damagetype Laser
  States
  {
  Spawn:
    TNT1 A 1 Bright
    Loop
  Death:
    EXCN A 1 A_PlaySound("katarn/exmiss",6,1.0,0,ATTN_NORM)
	EXCN A 0 A_Explode(60,128,0)
    EXCN BCDDEEFFGGHH 1 BRIGHT 
    Stop
  }
}

ACTOR concussion_projectile2 : concussion_projectile
{
  Species "Player"
  +THRUSPECIES
  +DONTHARMCLASS
  +DONTHARMSPECIES
  +MTHRUSPECIES
  States
  {
  Death:
    EXCN A 1 A_PlaySound("katarn/exmiss",6,1.0,0,ATTN_NORM)
	EXCN A 0 A_Explode(Random(180,240),128,0)
    EXCN BCDDEEFFGGHH 1 BRIGHT 
    Stop
  }  
}