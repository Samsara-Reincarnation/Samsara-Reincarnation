Actor RTCW_TeslaGun : RTCW_Weapon
{
	Weapon.SlotNumber 7
	Weapon.SelectionOrder 500
	Weapon.AmmoUse 2
	Weapon.AmmoGive 50
	Weapon.AmmoType "Cell"
	Obituary "%o was killed (tesla) by %k."
	Inventory.Pickupmessage "Tesla Gun"
	Inventory.PickupSound "RTCW/WeaponPickup"
	Tag "Tesla Gun"
	+WEAPON.AMMO_OPTIONAL
	+WEAPON.NOALERT
	States
	{
		Spawn:
			RW98 A -1
			Stop
		Ready:
			RW00 A 0 A_TakeInventory("RTCW_WeaponToken",256)
			RW00 A 0 A_GiveInventory("RTCW_WeaponToken",15)
			RW04 ABCD 2
		//This animation is so mean, it will cause less problems just to call the kicking here
		ReadyLoop:
			RW01 A 0
			RW01 A 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 A 0 A_GunFlash("Kicking")
			RW01 A 6 A_WeaponReady
			RW01 B 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 B 0 A_GunFlash("Kicking")
			RW01 B 6 A_WeaponReady
			RW01 C 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 C 0 A_GunFlash("Kicking")
			RW01 C 6 A_WeaponReady
			RW01 D 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 D 0 A_GunFlash("Kicking")
			RW01 D 6 A_WeaponReady
			RW01 E 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 E 0 A_GunFlash("Kicking")
			RW01 E 6 A_WeaponReady
			RW01 F 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 F 0 A_GunFlash("Kicking")
			RW01 F 6 A_WeaponReady
			RW01 G 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW01 G 0 A_GunFlash("Kicking")
			RW01 G 6 A_WeaponReady
			RW01 H 0
			RW00 A 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 A 0 A_GunFlash("Kicking")
			RW00 A 6 A_WeaponReady
			RW00 B 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 B 0 A_GunFlash("Kicking")
			RW00 B 6 A_WeaponReady
			RW00 C 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 C 0 A_GunFlash("Kicking")
			RW00 C 6 A_WeaponReady
			RW00 D 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 D 0 A_GunFlash("Kicking")
			RW00 D 6 A_WeaponReady
			RW00 E 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 E 0 A_GunFlash("Kicking")
			RW00 E 6 A_WeaponReady
			RW00 F 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 F 0 A_GunFlash("Kicking")
			RW00 F 6 A_WeaponReady
			RW00 G 0 A_JumpIfInventory("RTCW_Kicking",1,2)
			RW00 G 0 A_GunFlash("Kicking")
			RW00 G 6 A_WeaponReady
			RW00 H 0
			Loop
		NoAmmo:
			RW00 A 0 A_PlaySound("RTCW/NoAmmo",CHAN_5)
			RW00 A 17
			TNT1 A 0 A_SelectWeapon("RTCW_Knife")
			Goto Deselect
		Deselect:
			RW03 A 0 A_GunFlash("RemoveKick")
			RW03 A 0 A_TakeInventory("RTCW_Kicking",1)
			RW03 A 0 A_PlaySound("RTCW/Change",CHAN_7)
			RW03 ABCDE 2
			Goto Super::Deselect
		Fire:
			RW02 A 0 A_GunFlash("RemoveKick")
			RW02 A 0 A_JumpIfInventory("Cell",1,1)
			Goto NoAmmo
			RW02 A 0 A_TakeInventory("RTCW_Kicking",1)
			RW02 AB 2
			RW02 C 3
			RW02 D 0 A_GiveInventory("RTCW_BlazkoWeaponAlert",1)
			RW02 D 0 A_Recoil(0.25)
			RW02 D 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		Think1:
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLookAttempts",0,7)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLookAttempts",1)
			TNT1 A 0 A_FireBullets(CallACS("RTCW_TeslaAim",0),CallACS("RTCW_TeslaAim",1),-1,1,"RTCW_TeslaScan",CBAF_NORANDOM|FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaCollision",1,1)
			Goto Think1
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLook",1)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLook",5,1)
			Goto Think1
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLook",5)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLookAttempts",128)
			TNT1 A 0 A_Refire(1)
			Goto ReadyLoop+4
			RW02 D 0 A_JumpIfInventory("Cell",2,1)
			Goto NoAmmo
			RW02 DE 2
			RW02 F 3
			RW02 G 0 A_GiveInventory("RTCW_BlazkoWeaponAlert",1)
			RW02 G 0 A_Recoil(0.25)
			RW02 G 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		Think2:
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLookAttempts",0,7)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLookAttempts",1)
			TNT1 A 0 A_FireBullets(CallACS("RTCW_TeslaAim",0),CallACS("RTCW_TeslaAim",1),-1,1,"RTCW_TeslaScan",CBAF_NORANDOM|FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaCollision",1,1)
			Goto Think2
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLook",1)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLook",5,1)
			Goto Think2
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLook",5)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLookAttempts",128)
			TNT1 A 0 A_Refire(1)
			Goto ReadyLoop+7
			RW02 G 0 A_JumpIfInventory("Cell",2,1)
			Goto NoAmmo
			RW02 GH 2
			RW02 I 0
			RW02 A 3
			RW02 B 0 A_GiveInventory("RTCW_BlazkoWeaponAlert",1)
			RW02 B 0 A_Recoil(0.25)
			RW02 B 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		Think3:
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLookAttempts",0,7)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLookAttempts",1)
			TNT1 A 0 A_FireBullets(CallACS("RTCW_TeslaAim",0),CallACS("RTCW_TeslaAim",1),-1,1,"RTCW_TeslaScan",CBAF_NORANDOM|FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaCollision",1,1)
			Goto Think3
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLook",1)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLook",5,1)
			Goto Think3
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLook",5)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLookAttempts",128)
			TNT1 A 0 A_Refire(1)
			Goto ReadyLoop+1
			RW02 B 0 A_JumpIfInventory("Cell",2,1)
			Goto NoAmmo
			RW02 BC 2
			RW02 D 3
			RW02 E 0 A_GiveInventory("RTCW_BlazkoWeaponAlert",1)
			RW02 E 0 A_Recoil(0.25)
			RW02 E 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		Think4:
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLookAttempts",0,7)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLookAttempts",1)
			TNT1 A 0 A_FireBullets(CallACS("RTCW_TeslaAim",0),CallACS("RTCW_TeslaAim",1),-1,1,"RTCW_TeslaScan",CBAF_NORANDOM|FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaCollision",1,1)
			Goto Think4
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLook",1)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLook",5,1)
			Goto Think4
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLook",5)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLookAttempts",128)
			TNT1 A 0 A_Refire(1)
			Goto ReadyLoop+4
			RW02 E 0 A_JumpIfInventory("Cell",2,1)
			Goto NoAmmo
			RW02 EF 2
			RW02 G 3
			RW02 H 0 A_GiveInventory("RTCW_BlazkoWeaponAlert",1)
			RW02 H 0 A_Recoil(0.25)
			RW02 H 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		Think5:
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLookAttempts",0,7)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLookAttempts",1)
			TNT1 A 0 A_FireBullets(CallACS("RTCW_TeslaAim",0),CallACS("RTCW_TeslaAim",1),-1,1,"RTCW_TeslaScan",CBAF_NORANDOM|FBF_NORANDOMPUFFZ|FBF_EXPLICITANGLE)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaCollision",1,1)
			Goto Think5
			TNT1 A 0 A_GiveInventory("RTCW_TeslaLook",1)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaLook",5,1)
			Goto Think5
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLook",5)
			TNT1 A 0 A_TakeInventory("RTCW_TeslaLookAttempts",128)
			TNT1 A 0 A_Refire("Fire")
			Goto ReadyLoop+7
		Kicking:
			TNT1 A 2
			RW99 A 0 A_JumpIfInventory("RTCW_Kicking",1,"RemoveKick")
			RW99 ABCD 2
			RW99 E 0 A_FireCustomMissile("RTCW_KickProjectile",0,0,0,-8)
			RW99 EFGHI 2
			Stop
		RemoveKick:
			TNT1 A 1
			Stop
	}
}

/*Actor RTCW_TeslaProjectile : FastProjectile
{
	DamageType "RTCWTesla"
	Speed 192
	Radius 2
	Height 4
	Damage (20)
	+SEEKERMISSILE
	+SCREENSEEKER
	+SKYEXPLODE
	+DONTSPLASH
	+CANNOTPUSH
	+BLOODLESSIMPACT
	+HITTRACER
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 AA 1 A_SeekerMissile(60,90,SMF_LOOK,256,8)
			Goto Death	
		Death:
			TNT1 A 0 ACS_NamedExecuteWithResult("RTCW_TeslaArc",36,36)
			TNT1 A 2
			stop
	}
}*/

Actor RTCW_TeslaScan
{
	DamageType "RTCWTesla"
	+NOGRAVITY
	+PUFFGETSOWNER
	+DONTSPLASH
	+PUFFONACTORS
	+BLOODLESSIMPACT
	+HITTRACER
	States
	{
		Spawn:
		XDeath:
		Melee:
		Crash:
			TNT1 A 0 NoDelay ACS_NamedExecuteWithResult("RTCW_TeslaArc",36,36)
			TNT1 A 0 ACS_NamedExecuteWithResult("RTCW_TeslaResistance")
			TNT1 A 0 A_GiveToTarget("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaSoundToken",1,4,AAPTR_Target)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaSoundToken",3+random(0,3),AAPTR_Target)
			TNT1 A 0 A_PlaySound("RTCW/Tesla/Zap",CHAN_5)
			TNT1 A 0 A_GiveToTarget("RTCW_TeslaZapSoundToPlayer",1)
			TNT1 A 1
			Stop
	}
}

Actor RTCW_TeslaZap
{
	DamageType "RTCWTesla"
	+NOGRAVITY
	+PUFFGETSOWNER
	+DONTSPLASH
	+PUFFONACTORS
	+BLOODLESSIMPACT
	+HITTRACER
	States
	{
		Spawn:
		XDeath:
		Melee:
		Crash:
			TNT1 A 0 NoDelay ACS_NamedExecuteWithResult("RTCW_TeslaArc",36,36)
			TNT1 A 0 ACS_NamedExecuteWithResult("RTCW_TeslaResistance")
			TNT1 A 0 A_GiveToTarget("RTCW_TeslaCollision",1)
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaSoundToken",1,4,AAPTR_Target)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaSoundToken",3+random(0,3),AAPTR_Target)
			TNT1 A 0 A_PlaySound("RTCW/Tesla/Zap",CHAN_5)
			TNT1 A 0 A_GiveToTarget("RTCW_TeslaZapSoundToPlayer",1)
			TNT1 A 1
			Stop
	}
}

Actor RTCW_TeslaZapSoundToPlayer : Trigger
{
	States
	{
		Pickup:
			TNT1 A 0 A_PlaySound("RTCW/Tesla/Zap",CHAN_6)
			Stop
	}
}

/*Actor RTCW_TeslaProjectileSound : RTCW_TeslaProjectile
{
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_JumpIfInventory("RTCW_TeslaSoundToken",1,3,AAPTR_Target)
			TNT1 A 0 A_GiveInventory("RTCW_TeslaSoundToken",3+random(0,3),AAPTR_Target)
			TNT1 A 0 A_PlaySound("RTCW/Tesla/Zap",CHAN_5)
			TNT1 AA 1 A_SeekerMissile(60,90,SMF_LOOK,256,8)
			Goto Death	
		Death:
			TNT1 A 0 ACS_NamedExecuteWithResult("RTCW_TeslaArc",36,36)
			TNT1 A 2
			stop
	}
}*/

Actor RTCW_TeslaSegment1
{
	+NOINTERACTION
	+NOBLOCKMAP
	+CLIENTSIDEONLY
	Radius 1
	Height 1
	Renderstyle Add
	Alpha 1.0
	States
	{
		Spawn:
			TNT1 A 0
			RW00 AABBCCDD 1 Bright A_Fadeout(0.05)
			stop
	}
}

Actor RTCW_TeslaSegment2 : RTCW_TeslaSegment1 
{
	States
	{
		Spawn:
			TNT1 A 0
			RW00 BBCCDDAA 1 Bright A_Fadeout(0.05)
			stop
	}
}
Actor RTCW_TeslaSegment3 : RTCW_TeslaSegment1 
{
	States
	{
		Spawn:
			TNT1 A 0
			RW00 CCDDAABB 1 Bright A_Fadeout(0.05)
			stop
	}
}
Actor RTCW_TeslaSegment4 : RTCW_TeslaSegment1 
{
	States
	{
		Spawn:
			TNT1 A 0
			RW00 DDAABBCC 1 Bright A_Fadeout(0.05)
			stop
	}
}

Actor RTCW_TeslaMultiplier1 : PowerProtection 
{ 
	DamageFactor "RTCWTesla", 2.0 
	Powerup.Duration -17
	-DONTBLAST
	-DONTMORPH
	-DONTRIP
	-DONTSQUASH
	-NOPAIN
	-NORADIUSDMG
	-NOTELEOTHER
}
Actor RTCW_TeslaMultiplier2 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplier3 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplier4 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplier5 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplier6 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplier7 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplier8 : RTCW_TeslaMultiplier1 {}
Actor RTCW_TeslaMultiplierToken : Counter { Inventory.MaxAmount 17 }

Actor RTCW_TeslaSoundToken : Inventory { +INVENTORY.UNDROPPABLE Inventory.MaxAmount 7 Inventory.InterHubAmount 0  }
Actor RTCW_TeslaCollision : Inventory { +INVENTORY.UNDROPPABLE Inventory.MaxAmount 1 Inventory.InterHubAmount 0  }
Actor RTCW_TeslaLookAngle : Inventory { +INVENTORY.UNDROPPABLE Inventory.MaxAmount 255 Inventory.InterHubAmount 0  }
Actor RTCW_TeslaLook : Inventory { +INVENTORY.UNDROPPABLE Inventory.MaxAmount 5 Inventory.InterHubAmount 0  }
Actor RTCW_TeslaLookAttempts : Inventory { +INVENTORY.UNDROPPABLE Inventory.MaxAmount 128 Inventory.InterHubAmount 0  }

Actor RTCW_TeslaLight
{
	Radius 1
	Height 1
	+NOINTERACTION
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 1
			stop
	}
}