Actor RTCW_Knife : RTCW_Weapon
{
	Weapon.SlotNumber 0
	Weapon.SelectionOrder 2000
	Obituary "%o was knifed by %k."
	Inventory.Pickupmessage "Knife"
	Inventory.PickupSound "RTCW/WeaponPickup"
	Tag "Knife"
	+WEAPON.NOALERT
	States
	{
		Spawn:
			RW98 A -1
			Stop
		Deselect:
			RW00 V 0 A_PlaySound("RTCW/Change",CHAN_7)
			RW00 GHIJK 2
			Goto Super::Deselect
		Ready:
			RW00 A 0 A_TakeInventory("RTCW_WeaponToken",256)
			RW00 A 0 A_GiveInventory("RTCW_WeaponToken",1)
			RW00 LMNO 2
		ReadyLoop:
			RW00 A 0 A_JumpIfInventory("RTCW_Kicking",1,"Kicking")
			RW00 A 1 A_WeaponReady
			Loop
		Fire:
			RW00 B 0 A_PlaySound("RTCW/Knife/Shank",CHAN_WEAPON)
			RW00 B 2
			RW00 C 1
			RW00 D 0 A_FireCustomMissile("RTCW_KnifeAttack")
			RW00 D 2
			RW00 E 1
			RW00 F 2
			Goto ReadyLoop
		Kicking:
			TNT1 A 0 A_Gunflash("KickingFoot")
		KickingDelay:
			RW00 A 18
			RW00 A 0 A_TakeInventory("RTCW_Kicking",1)
			Goto ReadyLoop
		KickingFoot:
			RW99 ABCD 2
			RW99 E 0 A_FireCustomMissile("RTCW_KickProjectile",0,0,0,-8)
			RW99 EFGHI 2
			Stop
	}
}

Actor RTCW_KnifeAttack : FastProjectile
{
	Height 4
	Radius 2
	Speed 48
	Damage (0)
	Renderstyle Add
	DamageType "RTCWKnife"
	Decal "RTCW_BulletMark"
	+HITTRACER
	+NODAMAGETHRUST
	+NOEXTREMEDEATH
	States
	{
		Spawn:
			TNT1 AA 1
			Stop
		Death:
			TNT1 A 0 A_PlaySound("RTCW/Knife/HitWall",CHAN_5)
			TNT1 A 0 A_CheckFloor("ParticleFloor")
			TNT1 AAAAAAAA 0 A_SpawnItemEx("RTCW_BulletParticle",0,0,0,frandom(-0.5,0.5),frandom(-0.5,0.5),frandom(-0.25,-0.75))
			TNT1 A 1
			Stop
		ParticleFloor:
			TNT1 AAAAAAAA 0 A_SpawnItemEx("RTCW_BulletParticle",0,0,0,frandom(-0.5,0.5),frandom(-0.5,0.5),frandom(0.25,0.75))
			TNT1 A 1
			Stop
		XDeath:
			TNT1 A 0 A_Explode(CallACS("RTCW_KnifeDamage"),4,!XF_HURTSOURCE,0,4)
			TNT1 A 0 A_PlaySound("RTCW/Knife/Hit",CHAN_5)
			TNT1 A 0 A_FaceTarget(0,0)
			TNT1 A 0 ACS_NamedExecuteWithResult("RTCW_BloodGenerator_Offsets")
			TNT1 A 0 A_GiveInventory("RTCW_BloodGenerator",1,AAPTR_TRACER)
			TNT1 A 1
			Stop
	}
}

Actor RTCW_KnifeHintPuff
{
	Height 4
	Radius 2
	+PUFFONACTORS
	+PUFFGETSOWNER
	+NOINTERACTION
	+NOTRIGGER
	+BLOODLESSIMPACT
	+HITTRACER
	States
	{
		Spawn:
		Crash:
			TNT1 A 1
			Stop
		XDeath:
			TNT1 A 0 A_JumpIf(CallACS("RTCW_KnifeDamage",1)==1,"ShowHint")
			TNT1 A 2
			Stop
		ShowHint:
			TNT1 A 1 ACS_NamedExecuteWithResult("RTCW_Decorate",44)
			Stop
	}
}