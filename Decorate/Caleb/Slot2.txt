actor Flaregun : Weapon
{
  obituary "%k \cucooked\c- %o."
  attacksound "Flare/Fire"
  inventory.pickupmessage "You got the Flare Gun!"
  Inventory.PickupSound "Caleb/Weaponup"
  weapon.selectionorder 230
  weapon.bobstyle Smooth
  weapon.bobrangeX 0.2
  weapon.bobrangeY 0.4
  weapon.bobspeed 0.5 
  weapon.ammotype "Shell"
  weapon.ammouse 1
  Weapon.AmmoType2 "Shell"
  Weapon.AmmoUse2 0
  Tag "Flare Pistol"
  +Weapon.Noalert
  weapon.ammogive 8
  Weapon.SlotNumber 2
  Inventory.RestrictedTo "Caleb"  
  states
  {
  Ready:
    TNT1 A 0 A_TakeInventory("UsingPitchfork", 1)
	TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboReady")
	TNT1 A 0 A_JumpIfInventory("CalebReady",1,"IntroTaunt")
    TNT1 A 0 A_JumpIfInventory("CalebWaiting",60,"WaitingTaunt")	
    FLAR A 1 A_WeaponReady
    Goto Ready+1
  Deselect: 
    TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboDeselect")
  DeselectLoop:	
	TNT1 AA 0 A_Lower
    FLAR A 1 A_Lower
    loop
  Select:
    TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboSelect")
  SelectLoop:	
    TNT1 AA 0 A_Raise
    FLAR A 1 A_Raise
    Loop
  Fire:
    TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboFire")
	TNT1 A 0 A_GunFlash
	TNT1 A 3 A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF A 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light2
    FLAF B 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF C 2 bright A_WeaponReady(14)
    TNT1 A 0 A_Light0
	TNT1 A 8 A_WeaponReady(14)
    goto Ready
  AltFire:
    TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboAltfire")
	TNT1 A 0 A_JumpIfInventory("Shell", 3, 1)
	Goto Ready
	TNT1 A 0 A_GunFlash
	TNT1 A 3 A_WeaponReady(14)
	TNT1 A 0 A_light1
    FLAF A 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light2
    FLAF B 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF C 2 bright A_WeaponReady(14)
    TNT1 A 0 A_Light0
	TNT1 A 8 A_WeaponReady(14)
    goto Ready 
  Flash:
    TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboFlash")
	TNT1 A 0 A_AlertMonsters
    FLAR B 1 A_WeaponReady(14)
    FLAR A 0 Bright
    FLAR B 2 Bright A_WeaponReady(14)
	TNT1 A 0 A_PlayWeaponSound("Flare/Fire")
	TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"FlashCoop")	
	TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FlashCoop")
	TNT1 A 0 A_FireCustomMissile("FlareFire",0,1,9,0)
    FLAR I 2 bright A_WeaponReady(14)
    FLAR CDEFGH 2 A_WeaponReady(14)
    stop
  FlashCoop:
	TNT1 A 0 A_FireCustomMissile("FlareFireCoop",0,1,9,0) // 10
	TNT1 A 0 A_AlertMonsters	
    FLAR I 2 bright A_WeaponReady(14)
    FLAR CDEFG 2 A_WeaponReady(14)
	FLAR H 2 A_WeaponReady(14)
	Stop
  AltFlash:
    TNT1 A 0 A_JumpIfInventory("GunsAkimboP", 1, "AkimboAltFlash")
	TNT1 A 0 A_AlertMonsters	
    FLAR B 1 A_WeaponReady(14)
    FLAR A 0 Bright
    FLAR B 2 Bright A_WeaponReady(14)
	TNT1 A 0 A_PlayWeaponSound("Flare/Fire")
	TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"AltFlashCoop")	
	TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"AltFlashCoop")
	TNT1 A 0 A_FireCustomMissile("FlareAlt",0,1,9,0)
	TNT1 A 0 A_TakeInventory("Shell", 3, TIF_NOTAKEINFINITE)
    FLAR I 2 bright A_WeaponReady(14)
    FLAR CDEFGH 2 A_WeaponReady(14)
    stop
  AltFlashCoop:
	TNT1 A 0 A_AlertMonsters  
	TNT1 A 0 A_FireCustomMissile("FlareAltCoop",0,1,9,0) // 11
	TNT1 A 0 A_TakeInventory("Shell", 3, TIF_NOTAKEINFINITE)
    FLAR I 2 bright A_WeaponReady(14)
    FLAR CDEFG 2 A_WeaponReady(14)
	FLAR H 2 A_WeaponReady(14)
	stop
  AkimboReady:
  	TNT1 A 0 A_JumpIfInventory("CalebReady",1,"IntroTaunt")
    TNT1 A 0 A_JumpIfInventory("CalebWaiting",60,"WaitingTaunt")	
    FAKM A 1 A_WeaponReady
    Goto Ready+1
  AkimboDeselect: 
	TNT1 AA 0 A_Lower
    FAKM A 1 A_Lower
    loop
  AkimboSelect:
	TNT1 AA 0 A_Raise
    FAKM A 1 A_Raise
    loop
  AkimboFire:
    TNT1 A 0 A_GunFlash
	TNT1 A 1 A_WeaponReady(14)
	TNT1 A 0 A_Light2
    FLAF A 3 bright A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF B 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light0
    FLAF C 1 bright A_WeaponReady(14)
    TNT1 A 2 A_WeaponReady(14)
	TNT1 A 0 A_JumpIFNoAmmo("Ready")
	TNT1 A 0 A_Light2
    FLAF D 3 bright A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF E 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light0
    FLAF F 1 bright A_WeaponReady(14)
	TNT1 A 4 A_WeaponReady(14)
    TNT1 A 0 A_ReFire
    goto Ready
  AkimboAltFire:
    TNT1 A 0 A_JumpIfInventory("Shell", 3, 1)
	Goto Ready
    TNT1 A 0 A_GunFlash
	TNT1 A 1 A_WeaponReady(14)
	TNT1 A 0 A_Light2
    FLAF A 3 bright A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF B 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light0
    FLAF C 1 bright A_WeaponReady(14)
    TNT1 A 2 A_WeaponReady(14)
    TNT1 A 0 A_JumpIfInventory("Shell", 3, 1)
	Goto Ready	
	TNT1 A 0 A_Light2
    FLAF D 3 bright A_WeaponReady(14)
	TNT1 A 0 A_Light1
    FLAF E 2 bright A_WeaponReady(14)
	TNT1 A 0 A_Light0
    FLAF F 1 bright A_WeaponReady(14)
	TNT1 A 4 A_WeaponReady(14)
    TNT1 A 0 A_ReFire
    goto Ready 
  AkimboFlash:
	TNT1 A 0 A_JumpIfInventory("SPModeOn", 1, "AkimboFlashCoop")    
	TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "AkimboFlashCoop")
	TNT1 A 0 A_AlertMonsters	
    TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_FireCustomMissile("FlareFire",0,1,9,0)
	FAKM B 2 Bright A_WeaponReady(14)
    FAKM K 2 Bright A_WeaponReady(14)
    FAKM CDEDC 1 A_WeaponReady(14)
	TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_FireCustomMissile("FlareFire",0,1,-9,0)
	FAKM F 2 Bright A_WeaponReady(14)
    FAKM L 2 Bright A_WeaponReady(14)
    FAKM GIJIG 1 A_WeaponReady(14)
    FAKM A 2 A_WeaponReady(14)
    stop
  AkimboAltFlash:
	TNT1 A 0 A_JumpIfInventory("SPModeOn", 1, "AkimboAltFlashCoop")  
	TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "AkimboAltFlashCoop")
	TNT1 A 0 A_AlertMonsters	
    TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_FireCustomMissile("FlareAlt",0,1,9,3)
	TNT1 A 0 A_TakeInventory("Shell", 3, TIF_NOTAKEINFINITE)
    FAKM B 2 Bright A_WeaponReady(14)
    FAKM K 2 Bright A_WeaponReady(14)
    FAKM CDEDC 1 A_WeaponReady(14)
	TNT1 A 0 A_JumpIfInventory("Shell", 3, 1)
	Stop
	TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_FireCustomMissile("FlareAlt",0,1,-9,3)
	TNT1 A 0 A_TakeInventory("Shell", 3, TIF_NOTAKEINFINITE)
	FAKM F 2 Bright A_WeaponReady(14)
    FAKM L 2 Bright A_WeaponReady(14)
    FAKM GIJIG 1 A_WeaponReady(14)
    FAKM A 2 A_WeaponReady(14)
    stop
  AkimboFlashCoop:
    TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_AlertMonsters	
	TNT1 A 0 A_FireCustomMissile("FlareFireCoop",0,1,9,0)
	FAKM B 2 Bright A_WeaponReady(14)
    FAKM K 2 Bright A_WeaponReady(14)
    FAKM CDEDC 1 A_WeaponReady(14)
	TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_FireCustomMissile("FlareFireCoop",0,1,-9,0)
	FAKM F 2 Bright A_WeaponReady(14)
    FAKM L 2 Bright A_WeaponReady(14)
    FAKM GIJIG 1 A_WeaponReady(14)
    FAKM A 2 A_WeaponReady(14)
    stop
  AkimboAltFlashCoop:
    TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_AlertMonsters	
	TNT1 A 0 A_FireCustomMissile("FlareAltCoop",0,1,9,3)
	TNT1 A 0 A_TakeInventory("Shell", 3, TIF_NOTAKEINFINITE)
    FAKM B 2 Bright A_WeaponReady(14)
    FAKM K 2 Bright A_WeaponReady(14)
    FAKM CDEDC 1 A_WeaponReady(14)
	TNT1 A 0 A_JumpIfInventory("Shell", 3, 1)
	Stop
	TNT1 A 0 Bright A_PlaySound("Flare/Fire")
	TNT1 A 0 A_FireCustomMissile("FlareAltCoop",0,1,-9,3)
	TNT1 A 0 A_TakeInventory("Shell", 3, TIF_NOTAKEINFINITE)
	FAKM F 2 Bright A_WeaponReady(14)
    FAKM L 2 Bright A_WeaponReady(14)
    FAKM GIJIG 1 A_WeaponReady(14)
    FAKM A 2 A_WeaponReady(14)
    stop  	
  Spawn:
    FGRN A -1
    stop
  IntroTaunt:
	TNT1 A 0 A_JumpIfInventory("CalebBallgag",1,2)
	TNT1 A 0 A_PlaySoundEx("Caleb/Enter", "SoundSlot7", 0, 0)
	TNT1 A 0 A_TakeInventory("CalebReady", 1)
	TNT1 A 0 A_GiveInventory("CalebTauntCooldown",5)
	TNT1 A 0 ACS_NamedExecuteAlways("CalebTauntCooldown", 0)
	Goto Ready
  WaitingTaunt:
	TNT1 A 0 A_JumpIfInventory("CalebIdleBallgag",1,"IdleBallgagStuff")
	TNT1 A 0 A_JumpIfInventory("CalebBallgag",1,2)
	TNT1 A 0 A_PlaySoundEx("Caleb/Bored", "SoundSlot7", 0, 0)
	TNT1 A 0 A_TakeInventory("CalebWaiting", 525)
	TNT1 A 0 A_GiveInventory("CalebTauntCooldown",5)
	TNT1 A 0 ACS_NamedExecuteAlways("CalebTauntCooldown", 0)
	Goto Ready	
  IdleBallgagStuff:
	TNT1 A 0 A_TakeInventory("CalebWaiting",525)
	goto Ready	
  }
}

ACTOR FlareAlt // first flare ball that launches +8 after some time
{
   decal BFGScorch
   Radius 13
   Height 6
   Speed 25
   Scale 0.5
//   Damage (Random(25, 35) + random(4*random(1,2),10*random(2,1)))
   Alpha 0.9
   RENDERSTYLE ADD
   PROJECTILE
   +WINDTHRUST
   +STRIFEDAMAGE
// +ROCKETTRAIL
   +FULLVOLACTIVE
   damagetype "CalebFire"
   DeathSound "LifeLeech/Explode"
   activesound "Flare/Air"
   var int user_pitch;
   States
   {
   Spawn:
      TNT1 A 0
	  FALT A 0 A_LoopActiveSound // 20 tics of repetition
	  TNT1 A 0 A_SetUserVar("user_pitch", CallACS("FlareGunPitch"))
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
      FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
     Goto Dispatch
	Dispatch:
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*0),-5,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*0)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*-2),-2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*-2)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*-5),0,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*-5)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*-2),+2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*-2)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*0),+5,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*0)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*2),+2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*2)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*5),0,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*5)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 5 A_SpawnItemEx("FlareAltSub",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*2),-2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*2)),0,SXF_NOCHECKPOSITION)
	  Stop	       
	Death:
      BFE1 AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
      BFE1 A 0 A_PlayWeaponSound("Flare/Explode2")
	  TNT1 A 0 A_Explode(80, 120)
      FALT A 5 Bright A_SpawnItemEx("FlareKaboom5",-2,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
      Stop
   }
}

Actor FlareAltCoop : FlareAlt
{
	Species "Player"
	+THRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
//    Damage (Random(109, 121) + random(5*random(1,2),10*random(3,1)))	
	States
	{
   Spawn:
      FALT A 0 A_LoopActiveSound // 20 tics of repetition
	  TNT1 A 0 A_SetUserVar("user_pitch", CallACS("FlareGunPitch"))
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
      FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
      FALT A 2 Bright
      FALT AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT A 0 A_LoopActiveSound
	  Goto Dispatch   
	Dispatch:
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*0),-5,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*0)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*-2),-2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*-2)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*-5),0,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*-5)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*-2),+2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*-2)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*0),+5,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*0)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*2),+2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*2)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 0 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*5),0,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*5)),0,SXF_NOCHECKPOSITION)
	  TNT1 A 5 A_SpawnItemEx("FlareAltSubCoop",0,0,0,(cos(user_pitch/182)*25)+(cos(user_pitch/182)*40)+(sin(user_pitch/182)*2),-2,((-sin(user_pitch/182)*25)+(-sin(user_pitch/182)*40)+(cos(user_pitch/182)*2)),0,SXF_NOCHECKPOSITION)
	  Stop	   
	Death:
      BFE1 AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
      BFE1 A 0 A_PlayWeaponSound("Flare/Explode2")
	  TNT1 A 0 A_Explode(80, 148)
      FALT A 5 Bright A_SpawnItemEx("FlareKaboom5",-2,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
      Stop	  
	 }
}

ACTOR FlareAltSub : FlareAlt // one of the 8 small flare balls launched after some time
{
	scale 0.3
	Damage (0)
	states
	{
   Spawn:
      FALT A 0
	  FALT A 0 A_LoopActiveSound
	Flight:
      FALT A 1 Bright
      FALT A 0 A_CustomMissile("Flaretrail",0,0,random[FlareGun](0,360),2,random[FlareGun](-90,90))
      LOOP
   Death:
      BFE1 AAAAA 0 A_CustomMissile("Flaretrail",0,0,random[FlareGun](0,360),2,random[FlareGun](-90,90))
      BFE1 A 0 A_PlayWeaponSound("LifeLeech/Explode")
      BFE1 A 0 A_Explode(Random(10,15),120,1)	  	  
      TNT1 A 5 Bright A_SpawnItemEx("FlareKaboom4",-2,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
      Stop
	}
}

Actor FlareAltSubCoop : FlareAltSub { Species "Player" +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES +MTHRUSPECIES }

Actor FlareActorExplosion {
	Speed 0
	Height 4
	Radius 4
	Damage (0)
	Obituary "%k cooked %o."
	DamageType "CalebFire"
	PROJECTILE
	+RIPPER
	+BLOODLESSIMPACT
	+FORCERADIUSDMG
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_Jump(128,"Death")
			TNT1 A 0 A_ChangeFlag(PAINLESS,1)			
			Goto Death
		Death:
			TNT1 A 1 A_Explode(6/2, 10, 0)
			TNT1 A 1
			Stop
	}
}

Actor FlareActorExplosionCoop : FlareActorExplosion {
 	Species "Player" 
	+THRUSPECIES 
	+DONTHARMCLASS 
	+DONTHARMSPECIES 
	+MTHRUSPECIES
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_Jump(128,"Death")
			TNT1 A 0 A_ChangeFlag(PAINLESS,1)			
			Goto Death
		Death:
			TNT1 A 1 A_Explode(10/2, 20, 0)
			TNT1 A 1
			Stop
	}	
}

ACTOR FlareFire
{
   Radius 3
   Height 4
   Speed 50
   Scale 0.3
   Damage 0
   PROJECTILE
   +SEEKERMISSILE
// +ROCKETTRAIL    
   +DONTSPLASH
   +FOILINVUL
   +WINDTHRUST
   DamageType "CalebFire"
   DeathSound ""
   activesound "Flare/Air"
   var int user_radius;
   var int user_offsetz;
   var int user_angle;
   States
   {
   Spawn:
	  TNT1 A 0
      FAIR A 0 A_LoopActiveSound
   SpawnLoop:	  
      FALT ABC 1 Bright
      FALT AAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
	  FALT D 1 Bright
      FALT A 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))	  
      Loop
   Death:
   	  TNT1 A 1
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",0,0,random(0,360),2,random(-90,90))
      stop
   XDeath:
	  TNT1 A 0 A_SetUserVar("user_radius", CallACS("StickyLocation",1))
	  TNT1 A 0 A_SetUserVar("user_offsetz", CallACS("StickyLocation",2))
	  TNT1 A 0 A_SetUserVar("user_angle", CallACS("StickyLocation",3))
	  TNT1 A 0 A_SetScale(0.4)
      FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosion")  
      Stop
   Vanish:
	  TNT1 A 5 A_FadeOut
	  Stop
   }
}

Actor FlareFireCoop : FlareFire
{
	Species "Player"
	DamageType "CalebFire"
	+THRUSPECIES
	+MTHRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	states
	{
   XDeath:
	  TNT1 A 0 A_SetScale(0.4)   
      TNT1 A 0 A_SetUserVar("user_radius", CallACS("StickyLocation",1))
	  TNT1 A 0 A_SetUserVar("user_offsetz", CallACS("StickyLocation",2))
	  TNT1 A 0 A_SetUserVar("user_angle", CallACS("StickyLocation",3))
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR DEF 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  
	  TNT1 A 0 A_JumpIf(CallACS("StickyLocation",4) == 1, "Vanish")	  
	  FAIR GHI 1 Bright A_Warp(AAPTR_TRACER,user_radius >> 16,0,abs(user_offsetz),user_angle+180,WARPF_NOCHECKPOSITION|WARPF_COPYINTERPOLATION)
      FAIR AAAAA 0 A_CustomMissile("Flaretrail",FRandom(0.0,8.0),0,random(0,360),2,random(-90,90))
      TNT1 A 0 A_SpawnItemEx("FlareActorExplosionCoop")  	  
      Stop
	}
}

actor Flaretrail : NapalmDebris { Scale 0.1 Translation "176:191=32:47","208:223=16:31" } 

actor Flaretrail1
{
    Health 5
    Radius 1
    Height 1
    Speed 10
    Mass 30
    PROJECTILE
    +DONTSPLASH
    -NOGRAVITY
    -SOLID
	+NOBLOCKMAP
	+NOBLOCKMONST
	+THRUSPECIES
	+CLIENTSIDEONLY
    Damage 0
    Scale 0.1
    States
    {
    Spawn:
        FAIR ABCABCABCABCABCABCABCABCABCABCABCABC 3 Bright
        Stop
    Death:
        FAIR C 1 Bright
        Stop
    }
}

actor FlareKaboom
{  
  radius 64
  height 16
  renderstyle Add
  Scale 0.5
  +NOBLOCKMAP
  +NOGRAVITY  
  +DONTSPLASH
  +WINDTHRUST
  +FIXMAPTHINGPOS
  -SOLID
  +CLIENTSIDEONLY
  states
  {
  Spawn:
    FALT A 1 Bright
    FALT A 1 Bright A_Burst("FlareKaboom3")
    stop
  }
}

actor FlareKaboom2
{  
  radius 64
  height 16
  renderstyle Add
  +NOBLOCKMAP
  +NOGRAVITY  
  +DONTSPLASH
  +FIXMAPTHINGPOS
  -SOLID
  +CLIENTSIDEONLY  
  Scale 0.5
  states
  {
  Spawn:
    FALT A 1 Bright
    BFE1 A 0 A_SpawnDebris("FlareDebris")
    LLSX ABCDEFGHIJK 2 Bright
    stop
  }
}

actor FlareKaboom3 : FlareKaboom2
{    
  states
  {
	Spawn:
	FALT A 1 Bright
    BFE1 A 0 Bright A_SpawnItemEx("FlareKaboom2",0,0,0)
    BFE1 A 0 A_SpawnDebris("FlareDebris")
    LLSX ABCDEFGHIJK 2 Bright
    stop
  }
}

actor FlareKaboom4 : FlareKaboom2
{
  Scale 0.75
  states
  {
  Spawn:
    FALT A 1 Bright
    BFE1 A 0 A_SpawnDebris("FlareDebris")
    LLSX ABCDEFGHIJK 2 Bright A_FadeOut(0.08)
    stop
  }
}

actor FlareKaboom5 : FlareKaboom2
{
  Scale 1.0
  renderstyle normal	
  states
  {
  Spawn:
    FALT A 1 Bright
    BFE1 AAAAAAAAAAA 0 A_SpawnDebris("FlareDebris")
    LLSX ABCDEFGHIJK 2 Bright //A_FadeOut(0.08)
    stop
  }
}